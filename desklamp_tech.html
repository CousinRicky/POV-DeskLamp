<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DeskLamp 1.0 Technical Manual | POV-Ray Object Collection (Proposed)</title>
<link rel="stylesheet" type="text/css" href="desklamp.css">
</head>

<body>

<h1>DeskLamp 1.0 Technical Manual</h1>

<p>
<a href="desklamp.jpg" class="demo"><img src="desklamp_thumbnail.jpg" title="Larger demo image" alt="[Thumbnail which links to a larger demo image]"></a>
This manual describes tools used to construct the desk lamp. Ordinarily, you will not need to use these tools, but they may be used for constructing your own lamps.

<hr>

<h2 id="toc">Table of Contents</h2>

<table class="toc">
 <tr>
  <td>
   <ul>
    <li><a href="#Construction">Lamp construction tools</a>
     <ul>
      <li><a href="#Lamp_Bulb_Material">Lamp_Bulb_Material</a>
      <li><a href="#Lamp_Check">Lamp_Check</a>
      <li><a href="#Lamp_Coil_Normal">Lamp_Coil_Normal</a>
      <li><a href="#Lamp_Finish_Base">Lamp_Finish_Base</a>
      <li><a href="#Lamp_Flex_Angle">Lamp_Flex_Angle</a>
      <li><a href="#Lamp_Has4D">Lamp_Has4D</a>
      <li><a href="#Lamp_Isocoil">Lamp_Isocoil</a>
      <li><a href="#Lamp_Lighting">Lamp_Lighting</a>
      <li><a href="#Lamp_Lit_Finish">Lamp_Lit_Finish</a>
      <li><a href="#Lamp_Luminance">Lamp_Luminance</a>
      <li><a href="#Lamp_Orient_Trans">Lamp_Orient_Trans</a>
      <li><a href="#Lamp_Source">Lamp_Source</a>
      <li><a href="#Lamp_Switch">Lamp_Switch</a>
      <li><a href="#Lamp_Warnings">Lamp_Warnings</a>
      <li><a href="#Lamp_fn_Area_Adjust">Lamp_fn_Area_Adjust</a>
      <li><a href="#Lamp_fn_Coil_Normal">Lamp_fn_Coil_Normal</a>
      <li><a href="#Lamp_fn_Isocoil">Lamp_fn_Isocoil</a>
     </ul>
    <li><a href="#Bulb_design">Creating your own light bulb object</a>
    <li><a href="#Other_identifiers">Other identifiers</a>
    <li><a href="#About">About DeskLamp</a>
   </ul>
  </td> <td>
   <ul>
    <li><a href="desklamp.html">User Manual</a>
    <li><b>Technical Manual</b>
   </ul>
  </td>
 </tr>
</table>

<hr>

<h2 id="Construction">Lamp Construction Tools</h2>

<h3 id="Lamp_Bulb_Material">Macro Lamp_Bulb_Material (c_Light, c_Bulb, Glossy)</h3>

<p>Returns a material suitable for a glowing light bulb.

<p><strong>Warning:</strong> If the POV-Ray version or <code>#version</code> is less than 3.7, then <code>global_settings { ambient_light }</code> must remain at its default setting for this macro to work properly.

<h4>Argument</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>c_Light</code></td>
  <td>color</td>
  <td>The light emission color. Any filter or transmit components are ignored. This color will be filtered by <code>c_Bulb</code>. An appropriate value is the <code>c_Surface_out</code> output from <a href="#Lamp_Lighting">macro <code>Lamp_Lighting()</code></a>. Use <code>rgb 0</code> if the light is off.</td>
 </tr><tr>
  <td><code>c_Bulb</code></td>
  <td>color</td>
  <td>The color of the bulb. Any filter or transmit components are ignored.</td>
 </tr><tr>
  <td><code>Glossy</code></td>
  <td>float/Boolean</td>
  <td>Whether or not the material is glossy.</td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Check">Lamp_Check (s_Caller, Value, s_Name, Min, Max)</h3>

<p>A general argument range check. If the argument is out-of-range, the render is halted with a parse error and an informative message.

<h4>Arguments</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>s_Caller</code></td>
  <td>string</td>
  <td>The name of the macro that is requesting the range check.</td>
 </tr><tr>
  <td><code>Value</code></td>
  <td>float</td>
  <td>The value of the argument being checked.</td>
 </tr><tr>
  <td><code>s_Name</code></td>
  <td>string</td>
  <td>The formal parameter name of the argument being checked.</td>
 </tr><tr>
  <td><code>Min</code></td>
  <td>float</td>
  <td>The minimum allowed value.</td>
 </tr><tr>
  <td><code>Max</code></td>
  <td>float</td>
  <td>The maximum allowed value.</td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>


<h3 id="Lamp_Coil_Normal">Macro Lamp_Coil_Normal (Length, Flex, t_Texture)</h3>

<p>A flexible conduit with a helical texture normal. The object can be bent along a circular arc. The object in its unbent state is oriented vertically, with the bottom end at the origin. It is 1.27 units in diameter, with 3 coils per unit along its length.

<h4>Arguments</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>Length</code></td>
  <td>float</td>
  <td>The length of the conduit.</td>
 </tr><tr>
  <td><code>Flex</code></td>
  <td>float</td>
  <td>The amount of bending, in degrees. A positive value flexes in the <var>z</var> direction, and a negative value flexes in the &minus;<var>z</var> direction. The allowable range is &minus;180 to 180.</td>
 </tr><tr>
  <td><code>t_Texture</code></td>
  <td>texture</td>
  <td>The object’s base texture. A helical normal will be applied to this.</td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Finish_Base">Macro Lamp_Finish_Base (Diffuse, Occlusion)</h3>

<p>Creates ambient and diffuse statements consistent with the <code>Lamp_c_Ambient</code> and <code>Lamp_Diffuse</code> global parameters. This macro should be called from within a <code>finish</code> block, and is not intended for glowing objects.

<h4>Arguments</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>Diffuse</code></td>
  <td>float</td>
  <td>The desired finish diffuse.</td>
 </tr><tr>
  <td><code>Occlusion</code></td>
  <td>float</td>
  <td>An ambient multiplier. Use 1 for an ambient synchronized with the <code>Diffuse</code> argument; or a smaller value for a darker ambient.</td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Flex_Angle">Macro Lamp_Flex_Angle (lFlex, lRigid, uv_Aim)</h3>

<p>Returns the flex angle in radians required to aim a flexible neck at a given 2-D point. The aim direction is to the right of and perpendicular to the top of the neck. If no such angle is possible, then a number greater than <var>&pi;</var> is returned.

<h4>Arguments</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>lFlex</code></td>
  <td>float</td>
  <td>The length of the flexible part of neck.</td>
 </tr><tr>
  <td><code>lRigid</code></td>
  <td>float</td>
  <td>The length of the rigid uppermost part of neck.</td>
 </tr><tr>
  <td><code>uv_Aim</code></td>
  <td>2-D vector</td>
  <td>The point to be aimed at. The <code>.x</code> component must be non-negative.</td>
 </tr>
</table>

<p><img src="desklamp_flex_angle.png" alt="[Geometric diagram of the aiming of the flexible neck]" class="demo">

<h4>The Mathematics</h4>
<p>This section summarizes the derivation of the function used by <code>Lamp_Flex_Angle()</code>. You are free to ignore this section.
<dl>
 <dt>Solve:
 <dd>tan(<var>&phi;</var>) = (<b>P</b><sub><var>y</var></sub> &minus; <b>A</b><sub><var>y</var></sub>) / (<b>P</b><sub><var>x</var></sub> &minus; <b>A</b><sub><var>x</var></sub>) for <var>&phi;</var>
 <dt>Observe:
 <dd><b>C</b> = (<var>r</var> cos(<var>&phi;</var>) &minus; <var>r</var>, <var>r</var> sin(<var>&phi;</var>))
  <br><var>r</var> = <var>c</var>/<var>&phi;</var>
  <br><b>A</b> = <b>C</b> + (&minus;<var>a</var> sin(<var>&phi;</var>), <var>a</var> cos(<var>&phi;</var>))
  <br><b>A</b> = (<var>c</var> (cos(<var>&phi;</var>) &minus; 1) /  <var>&phi;</var> &minus; <var>a</var> sin(<var>&phi;</var>), <var>c</var> sin(<var>&phi;</var>) / <var>&phi;</var> + <var>a</var> cos(<var>&phi;</var>))
 <dt>Expanding the first equation, then simplifying:
 <dd><var>a</var> &minus; <b>P</b><sub><var>y</var></sub> cos(<var>&phi;</var>) + (<b>P</b><sub><var>x</var></sub> + <var>c</var>/<var>&phi;</var>) sin(<var>&phi;</var>) for <var>&phi;</var> &ne; 0
  <br><var>a</var> &minus; <b>P</b><sub><var>y</var></sub> + <var>c</var> for <var>&phi;</var> = 0
</dl>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Has4D">Macro Lamp_Has4D (v_Arg)</h3>

<p>Returns <code>true</code> if the argument has a <code>.t</code> component, <code>false</code> otherwise.

<p><strong>Caution:</strong> A scalar argument will test as having a <code>.t</code> component.

<h4>Argument</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>v_Arg</code></td>
  <td>vector</td>
  <td>The vector to be tested.</td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Isocoil">Macro Lamp_Isocoil (Length, Flex)</h3>

<p>A flexible helical conduit, implemented as an isosurface. The object can be bent along a circular arc. The object in its unbent state is oriented vertically, with the bottom end at the origin. It is 1.27 units in diameter, with 3 coils per unit along its length.

<h4>Arguments</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>Length</code></td>
  <td>float</td>
  <td>The length of the conduit.</td>
 </tr><tr>
  <td><code>Flex</code></td>
  <td>float</td>
  <td>The amount of bending, in degrees. A positive value flexes in the <var>z</var> direction, and a negative value flexes in the &minus;<var>z</var> direction. The allowable range is &minus;180 to 180.</td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Lighting">Macro Lamp_Lighting (s_Caller, c_Light, c_Bulb, rBulb, Brightness, c_Light_out, Light_brightness_out, Fade_distance_out, c_Surface_out)</h3>

<p>Calculates some lighting values for an <dfn title="radiating uniformly in all directions">isotropic</dfn> light source. The calculations assume a <code>fade_power</code> of 2.

<h4>Arguments</h4>
<p>Scalars used for color arguments will be automatically promoted to colors.
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th> <th>In/Out</th>
 </tr><tr>
  <td><code>s_Caller</code></td>
  <td>string</td>
  <td>The name of the calling macro. This name will be written with any error messages.</td>
  <td>input</td>
 </tr><tr>
  <td><code>c_Light</code></td>
  <td>color</td>
  <td>The color of the unfiltered light. Any filter or transmit components are ignored.</td>
  <td>input</td>
 </tr><tr>
  <td><code>c_Bulb</code></td>
  <td>color</td>
  <td>The color of the bulb, which acts as a filter on the light’s color. Any filter or transmit components are ignored.</td>
  <td>input</td>
 </tr><tr>
  <td><code>rBulb</code></td>
  <td>float</td>
  <td>The bulb radius in centimeters. For a standard A19 or A60 bulb, this is 3.0.</td>
  <td>input</td>
 </tr><tr>
  <td><code>Brightness</code></td>
  <td>float</td>
  <td>The light’s brightness in lumens. If negative, then the absolute value will be used, but reduced according to the luminance of the bulb color. If positive, then the bulb color will not affect the lumens. For example, if <code>Brightness</code> is 1100, then a red bulb will yield 1100 lumens; but if <code>Brightness</code> is &minus;1100, then a red bulb will yield only 234 lumens, because red is darker than white.
  </td>
  <td>input</td>
 </tr><tr>
  <td><code>c_Light_out</code></td>
  <td>color</td>
  <td>The calculated lighting color, adjusted for lumens, but without attenuation adjustments. To obtain the <code>light_source</code> color, multiply this by <code>Light_brightness_out</code>.</td>
  <td>output</td>
 </tr><tr>
  <td><code>Light_brightness_out</code></td>
  <td>float</td>
  <td>The calculated <code>light_source</code> brightness, relative to <code>c_Light_out</code>. To obtain the <code>light_source</code> color, multiply this by <code>c_Light_out</code>.</td>
  <td>output</td>
 </tr><tr>
  <td><code>Fade_distance_out</code></td>
  <td>float</td>
  <td>The calculated <code>fade_distance</code> for the <code>light_source</code>, in centimeters.</td>
  <td>output</td>
 </tr><tr>
  <td><code>c_Surface_out</code></td>
  <td>color</td>
  <td>The calculated bulb surface glow. This may be used as the <code>c_Light</code> argument to <a href="#Lamp_Bulb_Material"><code>macro Lamp_Bulb_Material()</code></a>.</td>
  <td>output</td>
 </tr>
</table>

<p>In order to receive the results of the calculations, the last 4 arguments must be identifiers that have already been declared.

<p>Error messages issued by <code>Lamp_Lighting()</code> will cite the formal parameters <code>c_Light</code>, <code>c_Bulb</code>, and <code>Brightness</code> by name; therefore, it will be helpful to the end user that any lamp macro that calls <code>Lamp_Lighting()</code> use the same names for its own corresponding formal parameters.

<p>The following illustration shows the filtering effects of the <code>Brightness</code> and <code>c_Bulb</code> arguments. It was rendered with <a href="https://github.com/UberPOV/UberPOV/releases" target="_blank">UberPOV</a> glare desaturation (<code>+GLD</code>) to give a proper luminance impression. Each spot is the illumination from a spotlight 1 meter from the surface. The bottom row shows that a negative <code>Brightness</code> causes the color of the bulb to reduce the lumens output. (The bulbs themselves are not rendered.) A light color such as yellow reduces the luminance only slightly, but a dark color such as blue reduces the luminance considerably. Although the second row from the top also has a negative <code>Brightness</code>, the luminance is not reduced, because the bulb is white.
<p><img src="desklamp_lighting.jpg" alt="[Bulb filter illustration]">

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Lit_Finish">Macro Lamp_Lit_Finish (Diffuse, Occlusion, c_Glow)</h3>

<p>Creates ambient and diffuse statements consistent with the <code>Lamp_c_Ambient</code> and <code>Lamp_Diffuse</code> global parameters, and adds additional ambient. This can be used on parts of a lamp very close to the light bulb. This macro should be called from within a <code>finish</code> block.

<p><strong>Warning:</strong> <code>global_settings { ambient_light }</code> must remain at its default setting for this macro to work properly.

<h4>Arguments</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>Diffuse</code></td>
  <td>float</td>
  <td>The desired finish diffuse.</td>
 </tr><tr>
  <td><code>Occlusion</code></td>
  <td>float</td>
  <td>An ambient multiplier. Use 1 for an ambient synchronized with the <code>Diffuse</code> argument; or a smaller value for a darker ambient.</td>
 </tr><tr>
  <td><code>c_Glow</code></td>
  <td>color</td>
  <td>Additional ambient effect, as from a nearby glowing object.</td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Luminance">Macro Lamp_Luminance (Color)</h3>

<p>Returns the gray scale value of a color, using <code>Lamp_c_Weights</code> as the luminance function.

<h4>Arguments</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>Color</code></td>
  <td>color</td>
  <td>The color to be evaluated.</td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Orient_Trans">Macro Lamp_Orient_Trans (pv_Base, v_Up, pv_Aim, Warning_up, Warning_aim)</h3>

<p>Returns a transformation that reorients and repositions an initially upright fixture. The un-transformed fixture is assumed to be at the origin and facing the +<var>z</var> direction.

<h4>Arguments</h4>
<p>Scalar arguments will be automatically promoted to vectors where necessary.
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th> <th>In/Out</th>
 </tr><tr>
  <td><code>pv_Base</code></td>
  <td>point vector</td>
  <td>The desired location of the base of the fixture, using the same unit of length as <code>pv_Aim</code>.</td>
  <td>input</td>
 </tr><tr>
  <td><code>v_Up</code></td>
  <td>vector</td>
  <td>The desired direction of the fixture’s vertical axis. If the null vector is used, then <code>y</code> is assumed.</td>
  <td>input</td>
 </tr><tr>
  <td><code>pv_Aim</code></td>
  <td>point vector</td>
  <td>A point in the direction at which the fixture will be facing, using the same unit of length as <code>pv_Base</code>. If this point is on the line passing through <code>pv_Base</code> along the direction of <code>v_Up</code>, then the final orientation will be indeterminate.</td>
  <td>input</td>
 </tr><tr>
  <td><code>Warning_up</code></td>
  <td>float/Boolean</td>
  <td>Will be set to <code>true</code> if <code>v_Up</code> is the null vector, <code>false</code> otherwise.</td>
  <td>output</td>
 </tr><tr>
  <td><code>Warning_aim</code></td>
  <td>float/Boolean</td>
  <td>Will be set to <code>true</code> if <code>v_Aim</code> is on the line passing through <code>pv_Base</code> along the direction of <code>v_Up</code>; <code>false</code> otherwise.</td>
  <td>output</td>
 </tr>
</table>

<p>In order to receive the warning statuses, the last 2 arguments must be identifiers that have already been declared.

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Source">Macro Lamp_Source (s_Caller, pv_Location, c_Light, Fade, v4_Soft, Photons, s_Hood, zHood, Xform)</h3>

<p>Creates a light source with a fade power of 2. If <code>Lamp_Debug</code> is <code>true</code>, then SDL code for the light source, and optionally, a simplified lamp fixture hood, is written to the debug stream.

<h4>Arguments</h4>
<p>Scalar arguments will be automatically promoted to colors or vectors where necessary.
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>s_Caller</code></td>
  <td>string</td>
  <td>The name of the calling macro. This name will be written with any error messages.</td>
 </tr><tr>
  <td><code>pv_Location</code></td>
  <td>point vector</td>
  <td>The location of the light source in centimeters, <em>relative to an arbitrary point on the fixture,</em> assuming that the fixture faces the +<var>z</var> direction, and prior to any transformations.</td>
 </tr><tr>
  <td><code>c_Light</code></td>
  <td>color</td>
  <td>The color of the light. The brightness of this color should be pre-adjusted for attenuation; an appropriate value can be obtained by multiplying <code>c_Light_out</code> and <code>Light_brightness_out</code> outputs from <a href="#Lamp_Lighting">macro <code>Lamp_Lighting()</code></a>.</td>
 </tr><tr>
  <td><code>Fade</code></td>
  <td>float</td>
  <td>The fade distance, in centimeters. An appropriate value is the <code>Fade_distance_out</code> output from <a href="#Lamp_Lighting">macro <code>Lamp_Lighting()</code></a>.</td>
 </tr><tr>
  <td><code>v4_Soft</code></td>
  <td>vector/4-tuple</td>
  <td><p>Area light control; the components are:
   <dl class="inline">
    <dt><code>.x</code>
    <dd>The diameter of the area light in centimeters, or use 0 for a point light.
    <dt><code>.y</code>
    <dd>The sampling resolution of the area light, corresponding to <code>Size_1</code> and <code>Size_2</code> in the POV-Ray Reference. This applies only if the <code><code>.x</code></code> component is nonzero.
    <dt><code>.z</code>
    <dd>The area light adaptive level. This applies only if the <code><code>.x</code></code> component is nonzero.
    <dt><code>.t</code>
    <dd>Boolean: whether or not to use area illumination. This works for POV-Ray 3.7 and later only, and applies only if the <code>.x</code> component is nonzero.
   </dl>
  </td>
 </tr><tr>
  <td><code>Photons</code></td>
  <td>float/Boolean</td>
  <td>Whether or not the light shoots photons.</td>
 </tr><tr>
  <td><code>s_Hood</code></td>
  <td>string</td>
  <td>This argument serves two functions: to determine what sort of light to create, and&mdash;if <code>Lamp_Debug</code> is <code>true</code>&mdash;to determine the style of hood to be coded in the debug stream output. Recognized styles are as follows:
   <dl class="compact">
    <dt><code>""</code> (the null string)
    <dd>The light source will be a 180&deg; spotlight with a cosine falloff. The light source code, if written, will be commented as radiosity replacement. No hood code will be written.
    <dt><code>"ovoid white"</code>
    <dd>The light source will be omnidirectional, and the code, if written, will include a white hemispherical hood, elongated in the <var>z</var> direction prior to any transformations.
   </dl>
  </td>
 </tr><tr>
  <td><code>zHood</code></td>
  <td>float</td>
  <td>How far the hood of the lamp fixture extends beyond the <em>center</em> of the light source, in centimeters. This argument is relevant only if <code>Lamp_Debug</code> is <code>true</code>.</td>
 </tr><tr>
  <td><code>Xform</code></td>
  <td>transformation</td>
  <td>A transformation to be applied to the light source. This should include any transformation to the light bulb and hood relative to the rest of the fixture, as well as the scaling and final positioning of the lamp fixture as a whole.
  </td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Switch">Macro Lamp_Switch (State)</h3>

<p>A light switch. The switch is rocker-style with a superellipse footprint, a surrounding rim, and a plastic-looking black texture. It is oriented horizontally and toggles in the <var>z</var>-direction.

<h4>Argument</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>State</code></td>
  <td>Boolean or float</td>
  <td>The on-off state. Although the switch type is binary, values between 0 and 1 are accepted and rendered accordingly.</td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_Warnings">Macro Lamp_Warnings()</h3>

<p>Issues warnings concerning questionable global parameter values. This macro should be called at the start of every lamp construction macro. Each warning will be issued only once, regardless of how many lamps are instantiated.

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_fn_Area_Adjust">Function Lamp_fn_Area_Adjust (x, y)</h3>

<p>Returns an adjustment to the physical size of an area light, based on the sampling resolution. Use this for the length of the area light vectors. See <a href="https://news.povray.org/57efd170%40news.povray.org">Area light idiosyncrasies</a> in povray.binaries.images for the rationale for this function.

<h4>Argument</h4>
<table>
 <tr>
  <th>Formal Parameter</th> <th>Type</th> <th>Description</th>
 </tr><tr>
  <td><code>x</code></td>
  <td>float</td>
  <td>The diameter of the light source.</td>
 </tr><tr>
  <td><code>y</code></td>
  <td>float</td>
  <td>The sampling resolution of the area light, corresponding to <code>Size_1</code> or <code>Size_2</code> in the POV-Ray Reference.</td>
 </tr>
</table>

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_fn_Coil_Normal">Function Lamp_fn_Coil_Normal (x, y, z)</h3>

<p>A function to be used in a texture normal that simulates a flexible helical conduit in its straightened state. The function is fitted to a vertical cylinder of radius 0.635 centered on the <var>y</var> axis, and has 3 coils per vertical unit. This function should be used with slope map <code>Lamp_sm_Coil</code>.

<p><a href="#toc">Table of contents</a><hr>

<h3 id="Lamp_fn_Isocoil">Function Lamp_fn_Isocoil (x, y, z)</h3>

<p>An isosurface function that yields a flexible helical conduit in its straightened state. The conduit is oriented vertically, is centered on the <var>y</var> axis, is 0.635 units in radius, and has 3 coils per vertical unit. The default isosurface threshold and polarity are assumed.

<p><a href="#toc">Table of contents</a><hr>

<h2 id="Bulb_design">Creating Your Own Light Bulb Object</h2>

<p>The light bulb object should be upright and scaled in centimeters. The origin should be at the top of the bulb’s base (screw-in cap or bayonet mount), with the base itself below the origin. The base, which will be hidden inside the socket, need not be modeled. If the height of the bulb is <a href="#Reference"><code>LAMP_HBULB</code></a>, then the end of the bulb will be flush with the mouth of the hood of <a href="desklamp.html#Lamp_Flexneck"><code>Lamp_Flexneck()</code></a>.

<p>DeskLamp uses the bounding box of the bulb to compute the light source position and the area light. If the bulb is complex or uses a <code>sphere_sweep</code>, intersecting it with a bounding object may be advisable.

<p>For DeskLamp to apply an automatic surface glow, any glowing part of the bulb <em>must be untextured.</em> If modeling a compact fluorescent bulb, the ballast (not including the base) should be above the origin and should have a texture.

<p><a href="#toc">Table of contents</a><hr>

<h2 id="Other_identifiers">Other Identifiers</h2>

<h3 id="Reference">Reference Identifiers</h3>

<table>
 <tr><th>Identifier</th> <th>Type</th> <th>Description</th> <th>Value</th></tr>
 <tr>
  <td><code>Lamp_sm_Coil</code></td>
  <td>float</td>
  <td>A slope map to be used with <a href="#Lamp_fn_Coil_Normal"><code>Lamp_fn_Coil_Normal</code></a> for a texture normal to simulate a flexible helical conduit.</td>
  <td></td>
 </tr><tr>
  <td><code>LAMP_HBULB</code></td>
  <td>float</td>
  <td>The assumed length of a light bulb in centimeters, excluding the base.</td>
  <td>8.6*</td>
 </tr>
</table>

<p>*Official numbers are elusive; the only reference I could find was on Wikipedia, and there was no sign of their figure at the cited source. Wikipedia’s figure, 110 mm, is longer than my A19 LED bulb, but shorter than my CFL (a spiriform compact fluorescent, probably around 800 lumens), so I just used the Wikipedia figure as a compromise and subtracted 24 mm for the screw-in base.

<h3>Internal Identifiers</h3>

<p>Any identifiers in <code>desklamp.inc</code> that are not documented in this Technical Manual or in the <a href="desklamp.html">User Manual</a> are considered “private” and are subject to change or elimination in a future update.

<p><a href="#toc">Table of contents</a><hr>

<h2 id="About">About DeskLamp</h2>

<address>
 <p>Copyright © 2022 Richard Callwood III. Some rights reserved.
 <p>This library is free software; you can redistribute it and/or modify it under the terms of the <a href="https://www.gnu.org/licenses/old-licenses/lgpl-2.1.html" target="_blank">GNU Lesser General Public License version 2.1</a> as published by the Free Software Foundation.
 <p>This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</address>

<p><a href="#toc">Table of contents</a>

</body>
</html>
